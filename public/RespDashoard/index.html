<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <!-- ====== Icons ====== -->
    <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>
    
    <!-- SheetJS for Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css">

    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>

	<title>Leader-Dashboard</title>
</head>
<body>
<!-- SIDEBAR -->
	<section id="sidebar">
		<a href="#" class="brand">
			<i class='bx bx-laptop'></i>
			<span class="text">LeaderHub</span>
		</a>
		<ul class="side-menu top">
			<li class="active">
				<a href="#" id="dashboard-link">
					<i class='bx bxs-dashboard'></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li>
				<a href="#" id="messages-link">
					<i class='bx bx-envelope'></i>
					<span class="text">Messages</span>
				</a>
			</li>
			
			<li>
				<a href="#" id="team-link">
					<i class='bx bxs-group'></i>
					<span class="text">Team</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
				<a href="#" id="settings-link">
					<i class='bx bxs-cog'></i>
					<span class="text">Settings</span>
				</a>
			</li>
			<li>
				<a href="/Home" class="logout">
					<i class='bx bxs-log-out-circle'></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
	</section>
	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class='bx bx-menu' ></i>
			<a href="#" class="nav-link">Categories</a>
			<form action="#">
				<div class="form-input">
					<input type="search" placeholder="Search...">
					<button type="submit" class="search-btn"><i class='bx bx-search' ></i></button>
				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<i class='bx bxs-bell' ></i>
				<span class="num">0</span>
			</a>
			<a href="#" class="profile">
				<i class='bx bx-user'></i>
			</a>
			<!-- Add Notifications Dropdown -->
			<div class="notifications-menu">
				<div class="notifications-header">
					<h3>Notifications</h3>
					<button class="clear-notifications">Clear All</button>
				</div>
				<div class="notifications-list">
					<!-- Notifications will be added here dynamically -->
				</div>
			</div>
		</nav>
		<!-- MAIN -->
		<main>
			<!-- Messages Section -->
			<div id="messages-section" style="display:none;">
				<div class="head-title">
					<div class="left">
						<h1>Messages</h1>
						<ul class="breadcrumb">
							<li><a href="#">Dashboard</a></li>
							<li><i class='bx bx-chevron-right'></i></li>
							<li><a class="active" href="#">Messages</a></li>
						</ul>
					</div>
				</div>
				<div class="messenger-container">
					<!-- Conversations List -->
					<div class="conversations-list">
						<div class="conversations-header">
							<h2>Messages</h2>
							<button class="new-message-btn">
								<i class='bx bx-plus'></i>
							</button>
						</div>
						<div class="conversations-search">
							<input type="text" id="message-search-input" placeholder="Search message...">
							<i class='bx bx-search'></i>
						</div>
						<div class="conversations">
							<div class="conversation active" data-conversation="admin">
								<div class="conversation-avatar">
									<i class='bx bx-user'></i>
								</div>
								<div class="conversation-info">
									<div class="conversation-name">Admin</div>
									<div class="conversation-preview">Welcome to the dashboard!</div>
								</div>
								<div class="conversation-time">10:30 AM</div>
							</div>
							<div class="conversation" data-conversation="system">
								<div class="conversation-avatar">
									<i class='bx bx-cog'></i>
								</div>
								<div class="conversation-info">
									<div class="conversation-name">System</div>
									<div class="conversation-preview">Your group assignment was updated</div>
								</div>
								<div class="conversation-time">Yesterday</div>
							</div>
						</div>
					</div>

					<!-- Chat Area -->
					<div class="chat-area">
						<div class="chat-header">
							<div class="chat-user">
								<div class="chat-avatar">
									<i class='bx bx-user'></i>
								</div>
								<div class="chat-info">
									<div class="chat-name">Admin</div>
									<div class="chat-status">Online</div>
								</div>
							</div>
						</div>
						<div class="chat-messages">
							
						</div>
						<form class="chat-input" id="chat-form">
							<div class="input-wrapper">
								<button type="button" class="attachment-btn" id="attachment-btn" aria-label="Attach photo">
									<i class="bx bx-image"></i>
								</button>
								<input type="file" id="image-upload" accept="image/*" style="display: none;" />
								<input id="msg_input" type="text" placeholder="Type a message..." autocomplete="off" required />
							</div>
							<button class="send-btn" type="submit" aria-label="Send message">
								<i class="bx bx-send"></i>
							</button>
						</form>
					</div>
				</div>
			</div>

			<!-- Message Modal -->
			<div id="message-modal" class="assign-modal" style="display:none;">
				<div class="assign-modal-content">
					<div class="assign-modal-title">Message Details</div>
					<div id="message-modal-body" style="margin: 20px 0;"></div>
					<button class="assign-btn" id="close-message-modal">Close</button>
				</div>
			</div>

			<!-- Reply Modal -->
			<div id="reply-modal" class="assign-modal" style="display:none;">
				<div class="assign-modal-content">
					<div class="assign-modal-title">Reply to Message</div>
					<div class="reply-form">
						<div class="form-group">
							<label>To:</label>
							<input type="text" id="reply-to" readonly>
						</div>
						<div class="form-group">
							<label>Subject:</label>
							<input type="text" id="reply-subject" placeholder="Enter subject">
						</div>
						<div class="form-group">
							<label>Message:</label>
							<textarea id="reply-message" placeholder="Type your message here..."></textarea>
						</div>
						<button class="assign-btn" id="send-reply">Send Reply</button>
						<button class="assign-btn" id="close-reply-modal">Cancel</button>
					</div>
				</div>
			</div>

			<!-- Team Management Section -->
			<!-- Team Section -->
			<div id="team-section" style="display:none;">
				<div class="head-title">
					<div class="left">
						<h1>Team Members</h1>
						<ul class="breadcrumb">
							<li><a href="#">Dashboard</a></li>
							<li><i class='bx bx-chevron-right'></i></li>
							<li><a class="active" href="#">Team</a></li>
						</ul>
					</div>
					<a href="#" class="btn-download">
						<i class='bx bxs-cloud-download'></i>
						<span class="text">Export</span>
					</a>
				</div>

				<div class="table-data">
					<div class="order">
						<div class="head">
							<h3>All Team Members</h3>
							<div class="search-container">
								<i class='bx bx-search search-icon'></i>
								<input type="text" id="team-search" placeholder="Search team member..." class="search-input">
							</div>
							<i class='bx bx-filter filter-icon' title="Filter"></i>
						</div>

						<div id="team-members-grid" class="team-members-grid">
							<!-- Team Member 1 -->
							

							<!-- Team Member 2 -->
							

							<!-- Team Member 3 -->
							

							<!-- Team Member 4 -->
							

							<!-- Team Member 5 -->
							
						</div>
					</div>
				</div>
			</div>
			</div>

			<!-- Add Member Modal -->
			<div id="add-member-modal" class="modal">
				<div class="modal-content">
					<div class="modal-header">
						<h3>Add New Team Member</h3>
						<span class="close-modal">&times;</span>
					</div>
					<div class="modal-body">
						<form id="add-member-form">
							<div class="form-group">
								<label for="member-name">Full Name</label>
								<input type="text" id="member-name" required placeholder="Enter member's full name">
							</div>
							<div class="form-group">
								<label for="member-email">Email</label>
								<input type="email" id="member-email" required placeholder="Enter member's email">
							</div>
							<div class="form-group">
								<label for="member-password">Password</label>
								<div class="password-input">
									<input type="password" id="member-password" required placeholder="Enter password">
									<i class='bx bx-show password-toggle'></i>
								</div>
							</div>
							<div class="form-group">
								<label for="member-team">Assign to Team</label>
								<select id="member-team" required>
									<option value="">Select a team</option>
									<option value="tech-support">Tech Support Team</option>
									<option value="customer-service">Customer Service Team</option>
									<option value="quality">Quality Team</option>
								</select>
							</div>
							<div class="form-group">
								<label for="member-role">Role</label>
								<select id="member-role" required>
									<option value="">Select a role</option>
									<option value="team-lead">Team Lead</option>
									<option value="senior">Senior Member</option>
									<option value="member">Team Member</option>
								</select>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn-secondary close-modal">Cancel</button>
						<button type="button" class="btn-primary" id="save-member">Add Member</button>
					</div>
				</div>
			</div>

		

			<div class="head-title">
				<div class="left">
					<h1>Dashboard</h1>
					<ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right' ></i></li>
						<li>
							<a class="active" href="#">Home</a>
						</li>
					</ul>
				</div>
				<a href="#" class="btn-download" id="download-pdf">
					<i class='bx bxs-cloud-download' ></i>
					<span class="text">Download PDF</span>
				</a>
			</div>

			<div class="table-data">
				<div class="order">
					<div class="head">
						<h3>Recent Complaints</h3>
						<i class='bx bx-refresh' title="Refresh" style="cursor:pointer" id="refresh-reclamation"></i>
						<i class='bx bx-filter' ></i>
					</div>
					<table>
						<thead>
							<tr>
								<th>User</th>
								<th>Date Order</th>
								<th>Actions</th>
								<th>Status</th>
							</tr>
						</thead>
						<tbody id="tbody">
							
						</tbody>
					</table>
				</div>
				<div class="todo">
					<div class="head">
						<h3>Todos</h3>
						<i class='bx bx-plus' id="add-todo"></i>
						<i class='bx bx-filter'></i>
					</div>
					<ul class="todo-list">
						<li class="completed">
							<p>Follow up team performance</p>
							<i class='bx bx-dots-vertical-rounded todo-actions'></i>
						</li>
						<li class="process">
							<p>Review new complaints</p>
							<i class='bx bx-dots-vertical-rounded todo-actions'></i>
						</li>
						<li class="not-completed">
							<p>Assign tasks to members</p>
							<i class='bx bx-dots-vertical-rounded todo-actions'></i>
						</li>
					</ul>
				</div>
			</div>

			<!-- Settings Section -->
			<div id="settings-section" style="display:none;">
				<div class="head-title">
					<div class="left">
						<h1>Settings</h1>
						<ul class="breadcrumb">
							<li><a href="#">Dashboard</a></li>
							<li><i class='bx bx-chevron-right'></i></li>
							<li><a class="active" href="#">Settings</a></li>
						</ul>
					</div>
				</div>
				<div class="settings-stack">
					<!-- Profile Settings Card -->
					<div class="settings-block">
						<div class="settings-block-title">
							<i class='bx bx-user-circle'></i>
							<span>Profile Settings</span>
						</div>
						<hr>
						<form id="profile-form">
							<label>Profile Picture</label>
							<div class="profile-upload">
								<div class="profile-pic"><i class='bx bx-user'></i></div>
								<button type="button" class="btn-upload">Change Photo</button>
							</div>
							<div class="form-group">
								<label>Full Name</label>
								<input type="text" id="settings-name" placeholder="Enter your name">
							</div>
							<div class="form-group">
								<label>Email</label>
								<input type="email" id="settings-email" placeholder="Enter your email">
							</div>
							<button type="submit" class="btn-save">Save Changes</button>
						</form>
					</div>
					<!-- Security Settings Card -->
					<div class="settings-block">
						<div class="settings-block-title">
							<i class='bx bx-lock-alt'></i>
							<span>Security Settings</span>
						</div>
						<hr>
						<form id="security-form">
							<div class="form-group">
								<label>Current Password</label>
								<input type="password" id="current-password" placeholder="Enter current password">
							</div>
							<div class="form-group">
								<label>New Password</label>
								<input type="password" id="new-password" placeholder="Enter new password">
							</div>
							<div class="form-group">
								<label>Confirm Password</label>
								<input type="password" id="confirm-password" placeholder="Confirm new password">
							</div>
							<button type="submit" class="btn-save">Update Password</button>
						</form>
					</div>
					<!-- Notification Settings Card -->
					<div class="settings-block">
						<div class="settings-block-title">
							<i class='bx bx-bell'></i>
							<span>Notification Settings</span>
						</div>
						<hr>
						<div class="notification-settings">
							<div class="setting-item">
								<div class="setting-info">
									<h4>Email Notifications</h4>
									<p>Receive email notifications for new tasks</p>
								</div>
								<label class="switch">
									<input type="checkbox" id="email-notifications" checked>
									<span class="slider"></span>
								</label>
							</div>
							<div class="setting-item">
								<div class="setting-info">
									<h4>Task Updates</h4>
									<p>Get notified when tasks are updated</p>
								</div>
								<label class="switch">
									<input type="checkbox" id="task-notifications" checked>
									<span class="slider"></span>
								</label>
							</div>
							<div class="setting-item">
								<div class="setting-info">
									<h4>Team Changes</h4>
									<p>Notifications about team member changes</p>
								</div>
								<label class="switch">
									<input type="checkbox" id="team-notifications">
									<span class="slider"></span>
								</label>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>
		<!-- MAIN -->
	</section>
	<!-- CONTENT -->


    <script src="script.js"></script>

    <script>
    // Function to export team data to Excel
    function exportTeamToExcel() {
        // Create an array with team data
        const teamData = [
            ['Name', 'Position', 'Status', 'Phone Number'],
            ['John Smith', 'Electronics Technician', 'Available', '+123456789'],
            ['Sarah Johnson', 'Appliance Specialist', 'Busy', '+123456789'],
            ['Michael Brown', 'HVAC Technician', 'Available', '+123456789'],
            ['Emily Davis', 'Electrician', 'Offline', '+123456789'],
            ['Robert Wilson', 'Plumbing Expert', 'Available', '+123456789'],
            ['Jennifer Lee', 'Painting Specialist', 'Available', '+123456789']
        ];

        // Create an Excel workbook
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(teamData);
        
        // Format columns
        const wscols = [
            {wch: 20}, // Name column width
            {wch: 25}, // Position column width
            {wch: 15}, // Status column width
            {wch: 15}  // Phone Number column width
        ];
        ws['!cols'] = wscols;
        
        // Add the sheet to the workbook
        XLSX.utils.book_append_sheet(wb, ws, 'Team Members');
        
        // Save the file
        const fileName = `Team_Members_${new Date().toISOString().split('T')[0]}.xlsx`;
        XLSX.writeFile(wb, fileName);
        
        // Show success notification
        showNotification('Team data exported successfully', 'success');
    }
    
    // Add search functionality
    function setupTeamSearch() {
        const searchInput = document.getElementById('team-search');
        const memberCards = document.querySelectorAll('.member-card');
        
        if (!searchInput) return;
        
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.trim().toLowerCase();
            
            memberCards.forEach(card => {
                const name = card.querySelector('h4').textContent.toLowerCase();
                const role = card.querySelector('.member-role').textContent.toLowerCase();
                
                if (name.includes(searchTerm) || role.includes(searchTerm)) {
                    card.style.display = '';
                    // إضافة تأثير ظهور عند ظهور النتيجة
                    card.style.animation = 'fadeIn 0.3s ease';
                } else {
                    card.style.display = 'none';
                }
            });
            
            // إظهار رسالة إذا لم توجد نتائج
            const visibleCards = document.querySelectorAll('.member-card[style*="display: block"], .member-card:not([style*="display:"])');
            const noResults = document.getElementById('no-results');
            
            if (visibleCards.length === 0) {
                if (!noResults) {
                    const noResultsMsg = document.createElement('div');
                    noResultsMsg.id = 'no-results';
                    noResultsMsg.className = 'no-results';
                    noResultsMsg.innerHTML = `
                        <i class='bx bx-search-alt'></i>
                        <p>No results for "${searchTerm}"</p>
                        <small>Try searching by name or role</small>
                    `;
                    document.querySelector('.team-members-grid').appendChild(noResultsMsg);
                }
            } else if (noResults) {
                noResults.remove();
            }
        });
    }
    
    // Handle chat icon clicks on team member cards
    function setupChatLinks() {
        document.querySelectorAll('.member-actions .bx-chat').forEach(chatIcon => {
            chatIcon.addEventListener('click', function(e) {
                e.preventDefault();
                // Get the team member's name and role
                const memberCard = this.closest('.member-card');
                const memberName = memberCard.querySelector('h4').textContent;
                const memberRole = memberCard.querySelector('.member-role').textContent;
                const memberStatus = memberCard.querySelector('.member-status').classList[1]; // available, busy, or offline
                
                // Store the selected team member in session storage
                sessionStorage.setItem('selectedMember', JSON.stringify({
                    name: memberName,
                    role: memberRole,
                    status: memberStatus
                }));
                
                // Switch to messages section
                document.querySelectorAll('main > div').forEach(section => {
                    section.style.display = 'none';
                });
                document.getElementById('messages-section').style.display = 'block';
                
                // Update active menu item
                document.querySelectorAll('#sidebar li').forEach(item => {
                    item.classList.remove('active');
                });
                document.getElementById('messages-link').parentElement.classList.add('active');
                
                // Scroll to top
                window.scrollTo(0, 0);
            });
        });
    }
    
    // Function to open chat with a specific team member
    function openChatWithMember(memberData) {
        // Check if conversation already exists
        let conversation = document.querySelector(`.conversation[data-conversation="${memberData.name.toLowerCase().replace(/\s+/g, '-')}"]`);
        
        if (!conversation) {
            // Create new conversation if it doesn't exist
            const conversationsList = document.querySelector('.conversations');
            if (conversationsList) {
                const newConversation = document.createElement('div');
                newConversation.className = 'conversation';
                newConversation.dataset.conversation = memberData.name.toLowerCase().replace(/\s+/g, '-');
                newConversation.innerHTML = `
                    <div class="conversation-avatar">
                        ${memberData.name.charAt(0).toUpperCase()}
                    </div>
                    <div class="conversation-info">
                        <div class="conversation-name">${memberData.name}</div>
                        <div class="conversation-preview">Start a new conversation</div>
                    </div>
                    <div class="conversation-time">Just now</div>
                `;
                conversationsList.prepend(newConversation);
                conversation = newConversation;
                
                // Add click handler for the new conversation
                conversation.addEventListener('click', function() {
                    // Remove active class from all conversations
                    document.querySelectorAll('.conversation').forEach(conv => {
                        conv.classList.remove('active');
                    });
                    // Add active class to clicked conversation
                    this.classList.add('active');
                    // Update chat header
                    updateChatHeader(memberData);
                });
            }
        } else {
            // If conversation exists, make it active
            document.querySelectorAll('.conversation').forEach(conv => {
                conv.classList.remove('active');
            });
            conversation.classList.add('active');
        }
        
        // Update chat header
        updateChatHeader(memberData);
        
        // Show messages section and hide others
        document.querySelectorAll('main > div').forEach(section => {
            section.style.display = 'none';
        });
        document.getElementById('messages-section').style.display = 'block';
        
        // Update active menu item
        document.querySelectorAll('#sidebar li').forEach(item => {
            item.classList.remove('active');
        });
        document.getElementById('messages-link').parentElement.classList.add('active');
        
        // Focus message input
        const messageInput = document.querySelector('.chat-input input');
        if (messageInput) {
            messageInput.focus();
        }
    }
    
    // Function to update chat header with member info
    function updateChatHeader(memberData) {
        const chatHeader = document.querySelector('.chat-header');
        if (chatHeader) {
            chatHeader.innerHTML = `
                <div class="chat-user">
                    <div class="chat-avatar">
                        ${memberData.name.charAt(0).toUpperCase()}
                    </div>
                    <div class="chat-user-info">
                        <h3>${memberData.name}</h3>
                        <p class="chat-status">
                            <span class="status-dot ${memberData.status}"></span>
                            ${memberData.status.charAt(0).toUpperCase() + memberData.status.slice(1)}
                        </p>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="chat-action-btn"><i class='bx bx-phone-call'></i></button>
                    <button class="chat-action-btn"><i class='bx bx-dots-vertical-rounded'></i></button>
                </div>
            `;
        }
        
        // Update chat messages
        const chatMessages = document.querySelector('.chat-messages');
        if (chatMessages) {
            chatMessages.innerHTML = `
                <div class="chat-start-message">
                    <p>Start a new conversation with ${memberData.name}</p>
                    <small>${memberData.role}</small>
                </div>
            `;
        }
    }
    
    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize search
        setupTeamSearch();
        
        // Setup chat links
        setupChatLinks();
        
        // Handle export button
        const exportBtn = document.querySelector('.btn-download');
        if (exportBtn) {
            exportBtn.addEventListener('click', function(e) {
                e.preventDefault();
                exportTeamToExcel();
            });
        }
        
        // Initialize settings page
        initSettingsPage();
        
        // Check if we're coming from team member click
        const selectedMember = sessionStorage.getItem('selectedMember');
        if (selectedMember && window.location.hash === '#messages') {
            const memberData = JSON.parse(selectedMember);
            openChatWithMember(memberData);
            sessionStorage.removeItem('selectedMember');
        }
    });
    
    // Initialize settings page functionality
    function initSettingsPage() {
        // Tab switching
        const menuItems = document.querySelectorAll('.settings-menu-item');
        const tabs = document.querySelectorAll('.settings-tab');
        
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all menu items and tabs
                menuItems.forEach(i => i.classList.remove('active'));
                tabs.forEach(tab => tab.classList.remove('active'));
                
                // Add active class to clicked menu item
                this.classList.add('active');
                
                // Show corresponding tab
                const tabId = this.getAttribute('data-tab') + '-tab';
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // Theme selection
        const themeOptions = document.querySelectorAll('.theme-option');
        themeOptions.forEach(option => {
            option.addEventListener('click', function() {
                themeOptions.forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                
                const theme = this.getAttribute('data-theme');
                if (theme === 'dark') {
                    document.body.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                } else if (theme === 'light') {
                    document.body.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                } else {
                    // System theme
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        document.body.classList.add('dark');
                    } else {
                        document.body.classList.remove('dark');
                    }
                    localStorage.setItem('theme', 'system');
                }
            });
        });
        
        // Font size slider
        const fontSizeSlider = document.getElementById('font-size');
        const fontSizeValue = document.querySelector('.range-value');
        
        if (fontSizeSlider && fontSizeValue) {
            // Update display value
            fontSizeValue.textContent = `${fontSizeSlider.value}px`;
            
            // Update on input
            fontSizeSlider.addEventListener('input', function() {
                const size = this.value;
                fontSizeValue.textContent = `${size}px`;
                document.documentElement.style.setProperty('--base-font-size', `${size}px`);
                localStorage.setItem('fontSize', size);
            });
        }
        
        // Density options
        const densityOptions = document.querySelectorAll('.density-option');
        densityOptions.forEach(option => {
            option.addEventListener('click', function() {
                densityOptions.forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                
                const density = this.getAttribute('data-density');
                document.body.setAttribute('data-density', density);
                localStorage.setItem('density', density);
            });
        });
        
        // Load saved settings
        loadSettings();
    }
    
    // Load saved settings from localStorage
    function loadSettings() {
        // Load theme
        const savedTheme = localStorage.getItem('theme') || 'system';
        if (savedTheme === 'dark' || (savedTheme === 'system' && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.body.classList.add('dark');
        } else {
            document.body.classList.remove('dark');
        }
        
        // Highlight selected theme option
        const themeOption = document.querySelector(`.theme-option[data-theme="${savedTheme}"]`);
        if (themeOption) {
            themeOption.classList.add('active');
        } else {
            document.querySelector('.theme-option[data-theme="system"]').classList.add('active');
        }
        
        // Load font size
        const savedFontSize = localStorage.getItem('fontSize') || '16';
        const fontSizeSlider = document.getElementById('font-size');
        if (fontSizeSlider) {
            fontSizeSlider.value = savedFontSize;
            document.documentElement.style.setProperty('--base-font-size', `${savedFontSize}px`);
            document.querySelector('.range-value').textContent = `${savedFontSize}px`;
        }
        
        // Load density
        const savedDensity = localStorage.getItem('density') || 'comfortable';
        document.body.setAttribute('data-density', savedDensity);
        const densityOption = document.querySelector(`.density-option[data-density="${savedDensity}"]`);
        if (densityOption) {
            densityOption.classList.add('active');
        }
    }

    // Hide all dropdowns if clicking outside
    document.addEventListener('click', function(event) {
        if (!event.target.closest('.assignee-cell')) {
    closeAllDropdowns();
  }
});
document.querySelectorAll('.assignee-cell').forEach(cell => {
  const icon = cell.querySelector('.assignee-icon');
  const dropdown = cell.querySelector('.group-dropdown');
  const groupNumSpan = cell.querySelector('.group-num');
  icon.addEventListener('click', function(e) {
    e.preventDefault();
    if (groupNumSpan.style.display === 'inline-block') return; // Don't open dropdown if already selected
    const isVisible = dropdown.style.display === 'block';
    closeAllDropdowns();
    dropdown.style.display = isVisible ? 'none' : 'block';
  });
  dropdown.querySelectorAll('li').forEach(item => {
    item.addEventListener('click', function() {
      // Hide icon, show number
      icon.style.display = 'none';
      groupNumSpan.textContent = this.textContent;
      groupNumSpan.style.display = 'inline-block';
      dropdown.style.display = 'none';
    });
  });
});
</script>
<style>
.group-dropdown {
  position: absolute;
  background: #fff;
  border-radius: 6px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.10);
  min-width: 54px;
  max-height: 120px;
  overflow-y: auto;
  z-index: 10;
  padding: 0;
  top: 30px;
  left: 50%;
  transform: translateX(-50%);
  border: 1px solid #e0e0e0;
  font-family: inherit;
  transition: box-shadow 0.18s;
}
.dropdown-header {
  background: #f7f7f7;
  font-weight: bold;
  color: #444;
  padding: 6px 0 5px 0;
  font-size: 14px;
  text-align: center;
  border-bottom: 1px solid #e0e0e0;
  letter-spacing: 1px;
}
.assignee-cell {
  position: relative;
  text-align: center;
}
.group-dropdown ul {
  list-style: none;
  margin: 0;
  padding: 0;
}
.group-dropdown ul li {
  padding: 5px 0;
  cursor: pointer;
  transition: background 0.15s, color 0.15s;
  font-size: 15px;
  color: #222;
  text-align: center;
  border-radius: 3px;
}
.group-dropdown ul li:hover {
  background: #e7f1ff;
  color: #0a58ca;
}
.assignee-icon {
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  font-size: 19px;
  color: #0a58ca;
  background: #f8f9fa;
  border-radius: 50%;
  padding: 5px 7px;
  transition: background 0.2s, color 0.2s;
  border: 1px solid #e1e1e1;
  min-width: 32px;
  min-height: 32px;
  justify-content: center;
}
.assignee-icon:hover {
  background: #e7f1ff;
  color: #0056b3;
}
.group-num {
  font-size: 16px;
  color: #0a58ca;
  font-weight: bold;
  display: inline-block;
  min-width: 18px;
  min-height: 32px;
  line-height: 32px;
  text-align: center;
}
</style>
<!-- Modal Overlay and Assign Modal -->
<div id="assign-overlay" class="assign-overlay" style="display:none;"></div>
<div id="assign-modal" class="assign-modal" style="display:none;">
    <div class="assign-modal-content">
        <div class="assign-modal-header">
            <h3>Assign Task</h3>
            <button class="close-modal">&times;</button>
        </div>
        <div class="assign-modal-body">
            <div class="search-box">
                <input type="text" id="member-search" placeholder="Search members...">
            </div>
            <div class="members-list">
                <!-- Tech Support Team -->
                <div class="team-section">
                    <div class="team-header">
                        <i class='bx bx-wrench'></i>
                        <span>Tech Support</span>
                    </div>
                    <div class="team-members">
                        <div class="member-item" onclick="selectMember(this)">John Doe</div>
                        <div class="member-item" onclick="selectMember(this)">Jane Smith</div>
                        <div class="member-item" onclick="selectMember(this)">Mike Johnson</div>
                    </div>
                </div>
                
                <!-- Customer Service Team -->
                <div class="team-section">
                    <div class="team-header">
                        <i class='bx bx-message-rounded-dots'></i>
                        <span>Customer Service</span>
                    </div>
                    <div class="team-members">
                        <div class="member-item" onclick="selectMember(this)">Alex Brown</div>
                        <div class="member-item" onclick="selectMember(this)">Emily Davis</div>
                        <div class="member-item" onclick="selectMember(this)">Chris Lee</div>
                    </div>
                </div>
                
                <!-- Quality Team -->
                <div class="team-section">
                    <div class="team-header">
                        <i class='bx bx-check-circle'></i>
                        <span>Quality Team</span>
                    </div>
                    <div class="team-members">
                        <div class="member-item" onclick="selectMember(this)">Robert White</div>
                        <div class="member-item" onclick="selectMember(this)">Jennifer Black</div>
                        <div class="member-item" onclick="selectMember(this)">Thomas Green</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="assign-modal-footer">
            <button id="assign-button" class="assign-btn" disabled>Assign Task</button>
        </div>
    </div>
</div>
<script>
// Modal logic
let selectedAssignCell = null;
let selectedGroupValue = null;
// Open modal on icon click
 document.querySelectorAll('.assignee-icon').forEach(icon => {
   icon.addEventListener('click', function(e) {
     e.preventDefault();
     selectedAssignCell = icon.closest('.assignee-cell');
     document.getElementById('assign-overlay').style.display = 'block';
     document.getElementById('assign-modal').style.display = 'flex';
     document.querySelectorAll('.assign-group-item').forEach(item => item.classList.remove('selected'));
     document.querySelector('.assign-btn').disabled = true;
     selectedGroupValue = null;
   });
 });
// Close modal on overlay click
 document.getElementById('assign-overlay').addEventListener('click', function() {
   document.getElementById('assign-overlay').style.display = 'none';
   document.getElementById('assign-modal').style.display = 'none';
 });
// Select group
 document.querySelectorAll('.assign-group-item').forEach(item => {
   item.addEventListener('click', function() {
     document.querySelectorAll('.assign-group-item').forEach(i => i.classList.remove('selected'));
     this.classList.add('selected');
     selectedGroupValue = this.getAttribute('data-value');
     document.querySelector('.assign-btn').disabled = false;
   });
 });
// Assign action
 document.querySelector('.assign-btn').addEventListener('click', function() {
   if(selectedAssignCell && selectedGroupValue) {
     // Hide the assign icon
     selectedAssignCell.querySelector('.assignee-icon').style.display = 'none';
     // Change the status to Process
     const row = selectedAssignCell.closest('tr');
     if(row) {
       const statusCell = row.querySelector('td:last-child span.status');
       if(statusCell) {
         statusCell.textContent = 'Process';
         statusCell.className = 'status process';
       }
     }
     // Hide modal and overlay
     document.getElementById('assign-overlay').style.display = 'none';
     document.getElementById('assign-modal').style.display = 'none';
   }
 });
// Search filter
 document.querySelector('.assign-search').addEventListener('input', function() {
   let val = this.value.toLowerCase();
   document.querySelectorAll('.assign-group-item').forEach(item => {
     let name = item.querySelector('.assign-group-name').textContent.toLowerCase();
     item.style.display = name.includes(val) ? '' : 'none';
   });
 });
</script>
<style>
.assign-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(40, 50, 70, 0.28);
  backdrop-filter: blur(2px);
  z-index: 1000;
}
.assign-modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1100;
}
.assign-modal-content {
  background: #fff;
  border-radius: 18px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.13);
  padding: 32px 30px 22px 30px;
  min-width: 340px;
  max-width: 94vw;
  min-height: 320px;
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
.assign-modal-title {
  font-size: 1.55rem;
  font-weight: bold;
  margin-bottom: 18px;
  color: #222;
  letter-spacing: 0.5px;
}
.assign-search {
  padding: 10px 14px;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
  font-size: 1rem;
  margin-bottom: 18px;
  outline: none;
  transition: border 0.2s;
}
.assign-search:focus {
  border: 1.5px solid #1976d2;
}
.assign-group-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 28px;
  max-height: 160px;
  overflow-y: auto;
}
.assign-group-item {
  display: flex;
  align-items: center;
  background: #f9fafe;
  border: 1.5px solid #ececec;
  border-radius: 10px;
  padding: 11px 14px;
  cursor: pointer;
  transition: border 0.18s, background 0.18s;
}
.assign-group-item.selected {
  border: 1.5px solid #1976d2;
  background: #e7f1ff;
}
.assign-group-icon {
  font-size: 1.45rem;
  margin-right: 13px;
  display: flex;
  align-items: center;
}
.assign-group-info {
  display: flex;
  flex-direction: column;
}
.assign-group-name {
  font-size: 1.07rem;
  font-weight: 500;
  color: #1b1b1b;
}
.assign-group-members {
  font-size: 0.95rem;
  color: #888;
  margin-top: 2px;
}
.assign-btn {
  margin-top: 12px;
  padding: 11px 0;
  border-radius: 11px;
  background: #1976d2;
  color: #fff;
  font-size: 1.13rem;
  font-weight: bold;
  border: none;
  cursor: pointer;
  transition: background 0.18s;
}
.assign-btn:disabled {
  background: #bcd4f6;
  cursor: not-allowed;
}
.messages-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  padding: 32px 24px;
  margin: 32px auto;
  max-width: 680px;
}
.messages-card h2 {
  margin-bottom: 18px;
  font-size: 1.5rem;
  color: #2a4c7b;
}
.messages-table {
  width: 100%;
  border-collapse: collapse;
}
.messages-table th, .messages-table td {
  padding: 10px 12px;
  text-align: left;
}
.messages-table th {
  background: #f3f7fa;
  color: #2a4c7b;
}
.messages-table tr {
  border-bottom: 1px solid #eee;
  cursor: pointer;
  transition: background 0.15s;
}
.messages-table tr:hover {
  background: #f0f6ff;
}
.assign-modal-content .assign-btn#close-message-modal {
  background: #2a4c7b;
  color: #fff;
  margin-top: 8px;
}
</style>
<script>
// Show messages section
const dashboardLink = document.getElementById('dashboard-link');
const messagesLink = document.getElementById('messages-link');
const mainContent = document.querySelector('main > .head-title').parentElement;
const messagesSection = document.getElementById('messages-section');

dashboardLink.addEventListener('click', function(e) {
  e.preventDefault();
  messagesSection.style.display = 'none';
  mainContent.querySelector('.head-title').style.display = '';
  mainContent.querySelectorAll(':scope > *:not(#messages-section):not(#message-modal)').forEach(el => {
    if(el !== messagesSection && el.id !== 'message-modal') el.style.display = '';
  });
});

messagesLink.addEventListener('click', function(e) {
  e.preventDefault();
  messagesSection.style.display = '';
  mainContent.querySelector('.head-title').style.display = 'none';
  mainContent.querySelectorAll(':scope > *:not(#messages-section):not(#message-modal)').forEach(el => {
    if(el !== messagesSection && el.id !== 'message-modal') el.style.display = 'none';
  });
});

// Show message modal on row click
Array.from(document.querySelectorAll('.message-row')).forEach(row => {
  row.addEventListener('click', function() {
    document.getElementById('message-modal-body').innerText = row.getAttribute('data-message');
    document.getElementById('message-modal').style.display = '';
    document.getElementById('assign-overlay').style.display = '';
  });
});
document.getElementById('close-message-modal').onclick = function() {
  document.getElementById('message-modal').style.display = 'none';
  document.getElementById('assign-overlay').style.display = 'none';
};
</script>
</body>
<style>
  .assignee-group-dropdown {
    padding: 5px 10px;
    border-radius: 4px;
    border: 1px solid #bbb;
    background: #fff;
    min-width: 140px;
    font-size: 15px;
    margin: 0 0 0 4px;
  }
</style>
<!-- Todo Actions Menu -->
<div class="todo-actions-menu" style="display: none;">
    <div class="menu-item" data-status="completed">
        <i class='bx bx-check-circle'></i> Mark as Completed
    </div>
    <div class="menu-item" data-status="process">
        <i class='bx bx-time-five'></i> Mark as In Process
    </div>
    <div class="menu-item" data-status="not-completed">
        <i class='bx bx-x-circle'></i> Mark as Not Completed
    </div>
    <div class="menu-item delete-todo">
        <i class='bx bx-trash'></i> Delete
    </div>
</div>

<!-- Add Todo Modal -->
<div id="add-todo-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add New Todo</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <input type="text" id="new-todo-input" placeholder="Enter todo text...">
            <select id="todo-status">
                <option value="not-completed">Not Completed</option>
                <option value="process">In Process</option>
                <option value="completed">Completed</option>
            </select>
        </div>
        <div class="modal-footer">
            <button id="save-todo" class="btn-primary">Add Todo</button>
            <button class="btn-secondary close-modal">Cancel</button>
        </div>
    </div>
</div>

<!-- Logout Confirmation Modal -->
<div id="logout-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Confirm Logout</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to logout?</p>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary close-modal">Cancel</button>
            <button class="btn-primary" id="confirm-logout">Logout</button>
        </div>
    </div>
</div>

<!-- Complaint Info Modal -->
<div id="complaint-modal-overlay" class="complaint-modal-overlay" style="display:none;">
  <div class="complaint-modal">
    <div class="complaint-modal-header">
      <button class="complaint-modal-close" onclick="closeComplaintInfoModal()" aria-label="Close">&times;</button>
      <div class="complaint-modal-title">Complaint Details</div>
    </div>
    <div id="complaint-modal-body" class="complaint-modal-body"></div>
  </div>
</div>

<script>/*
function showComplaintInfo(btn) {
  var row = btn.closest('tr');
  var user = row.querySelector('td p').innerText;
  var details = {
	'فطيم': 'Complaint details for aya inas: ...',
    'aya inas': 'Complaint details for aya inas: ...',
    'ben krouda gogo': 'Complaint details for ben krouda gogo: ...',
    'Benali fellague mimi': 'Complaint details for Benali fellague mimi: ...',
    'kada besoltan ipti': 'Complaint details for kada besoltan ipti: ...',
    'luna fatima': 'Complaint details for luna fatima: ...'
  };
  var info = details[user] || 'No details available.';
  document.getElementById('complaint-modal-body').innerText = info;
  document.getElementById('complaint-modal-overlay').style.display = 'flex';
  document.body.style.overflow = 'hidden';
}*/
function closeComplaintInfoModal() {
  document.getElementById('complaint-modal-overlay').style.display = 'none';
  document.body.style.overflow = '';
}
</script>

</html>